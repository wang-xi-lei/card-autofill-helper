<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>测试卡号生成器</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 40px 20px;
      color: #333;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.98);
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
      backdrop-filter: blur(10px);
    }

    .header {
      padding: 35px 40px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-bottom: none;
    }

    .header h1 {
      font-size: 28px;
      font-weight: 700;
      color: white;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .main {
      display: grid;
      grid-template-columns: 420px 1fr;
      min-height: 650px;
    }

    /* 左侧配置区 */
    .config-panel {
      background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
      border-right: 1px solid rgba(0,0,0,0.06);
      padding: 35px;
    }

    .panel-title {
      font-size: 18px;
      font-weight: 700;
      color: #495057;
      margin-bottom: 28px;
      padding-bottom: 16px;
      border-bottom: 3px solid #667eea;
      position: relative;
    }

    .panel-title::after {
      content: '';
      position: absolute;
      bottom: -3px;
      left: 0;
      width: 60px;
      height: 3px;
      background: #764ba2;
      border-radius: 3px;
    }

    .form-group {
      margin-bottom: 22px;
    }

    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 700;
      color: #495057;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.8px;
    }

    .form-input, .form-select {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #dee2e6;
      border-radius: 10px;
      font-size: 15px;
      background: white;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    .form-input:hover, .form-select:hover {
      border-color: #adb5bd;
    }

    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15);
      transform: translateY(-1px);
    }

    .form-select {
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 14 14'%3E%3Cpath fill='%23667eea' d='M7 10L2 5h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 14px center;
      padding-right: 40px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }

    /* 开关控件 */
    .switch-group {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 18px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 10px;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 52px;
      height: 28px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, #adb5bd, #ced4da);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 28px;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 22px;
      width: 22px;
      left: 3px;
      bottom: 3px;
      background: white;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 50%;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    input:checked + .slider {
      background: linear-gradient(135deg, #667eea, #764ba2);
    }

    input:checked + .slider:before {
      transform: translateX(24px);
    }

    .slider:hover {
      opacity: 0.9;
    }

    .switch-label {
      font-size: 13px;
      font-weight: 700;
      color: #495057;
      text-transform: uppercase;
      letter-spacing: 0.8px;
    }

    /* 生成按钮 */
    .btn-generate {
      width: 100%;
      padding: 16px 24px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .btn-generate:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    .btn-generate:active {
      transform: translateY(0);
      box-shadow: 0 2px 10px rgba(102, 126, 234, 0.4);
    }

    /* 右侧结果区 */
    .result-panel {
      display: flex;
      flex-direction: column;
      background: white;
    }

    .tabs {
      display: flex;
      border-bottom: 2px solid #e9ecef;
      background: linear-gradient(180deg, #f8f9fa 0%, #fff 100%);
      padding: 0 15px;
    }

    .tab {
      padding: 18px 35px;
      font-size: 15px;
      font-weight: 600;
      color: #6c757d;
      background: transparent;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .tab:hover {
      color: #667eea;
      background: rgba(102, 126, 234, 0.08);
    }

    .tab.active {
      color: #667eea;
      border-bottom-color: #667eea;
      background: white;
    }

    .tab.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 50%;
      transform: translateX(-50%);
      width: 40%;
      height: 3px;
      background: linear-gradient(90deg, transparent, #764ba2, transparent);
      border-radius: 3px;
    }

    .tab-content {
      flex: 1;
      padding: 30px 35px;
      display: flex;
      flex-direction: column;
    }

    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .result-stats {
      display: flex;
      gap: 20px;
      font-size: 14px;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border-radius: 20px;
      color: #495057;
      font-weight: 600;
    }

    .stat-value {
      font-weight: 700;
      color: #667eea;
    }

    .result-output {
      flex: 1;
      background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%);
      border: 2px solid #e9ecef;
      border-radius: 12px;
      padding: 24px;
      font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.9;
      overflow-y: auto;
      white-space: pre;
      color: #212529;
      min-height: 450px;
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.04);
    }

    .result-output:empty::before {
      content: '✨ 点击左侧"生成"按钮开始生成测试卡号...';
      color: #adb5bd;
      font-style: italic;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .result-actions {
      display: flex;
      gap: 14px;
      margin-top: 24px;
    }

    .btn {
      padding: 12px 28px;
      border: 2px solid #dee2e6;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      background: white;
      color: #495057;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn:hover {
      border-color: #667eea;
      color: #667eea;
      background: rgba(102, 126, 234, 0.08);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: transparent;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
      color: white;
    }

    /* Toast */
    .toast {
      position: fixed;
      top: 30px;
      right: 30px;
      background: white;
      padding: 18px 24px;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      border-left: 5px solid #667eea;
      z-index: 1000;
      animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 600;
      color: #495057;
      min-width: 280px;
    }

    .toast.error {
      border-left-color: #e74c3c;
    }

    .toast.success {
      border-left-color: #667eea;
    }

    @keyframes slideIn {
      from {
        transform: translateX(450px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes fadeOut {
      to {
        opacity: 0;
        transform: translateX(450px);
      }
    }

    .hidden {
      display: none;
    }

    @media (max-width: 1024px) {
      .main {
        grid-template-columns: 380px 1fr;
      }
    }

    @media (max-width: 768px) {
      body {
        padding: 0;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .container {
        border-radius: 0;
        box-shadow: none;
      }

      .header {
        padding: 25px 20px;
      }

      .header h1 {
        font-size: 22px;
      }

      .main {
        grid-template-columns: 1fr;
      }

      .config-panel {
        border-right: none;
        border-bottom: 2px solid rgba(0,0,0,0.06);
        padding: 25px 20px;
      }

      .tab-content {
        padding: 20px;
      }

      .result-stats {
        flex-direction: column;
        gap: 10px;
      }

      .form-row {
        grid-template-columns: 1fr;
      }

      .result-actions {
        flex-direction: column;
      }

      .btn {
        width: 100%;
        justify-content: center;
      }

      .toast {
        top: 15px;
        right: 15px;
        left: 15px;
        min-width: auto;
      }
    }

    /* 滚动条美化 */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(0,0,0,0.03);
      border-radius: 5px;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 5px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #764ba2, #667eea);
    }

    /* 选中文本的颜色 */
    ::selection {
      background: rgba(102, 126, 234, 0.3);
      color: #212529;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>💳 测试卡号生成器</h1>
    </div>

    <div class="main">
      <!-- 左侧配置面板 -->
      <div class="config-panel">
        <div class="panel-title">基础配置</div>

        <div class="form-group">
          <label class="form-label">选择 BIN</label>
          <select class="form-select" id="binSelect" onchange="updateBinFromSelect()">
            <option value="">-- 选择预设 BIN --</option>
            <option value="559888">559888</option>
            <option value="421769">421769 - Visa</option>
            <option value="532925">532925 - MasterCard</option>
            <option value="378282">378282 - Amex</option>
            <option value="601111">601111 - Discover</option>
            <option value="352800">352800 - JCB</option>
            <option value="300000">300000 - Diners</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">自定义 BIN（优先）</label>
          <input type="text" class="form-input" id="binInput" placeholder="输入4-8位数字" maxlength="8">
        </div>

        <div class="form-group">
          <label class="form-label">输出格式</label>
          <select class="form-select" id="formatSelect">
            <option value="PIPE">PIPE ( | )</option>
            <option value="CSV">CSV ( , )</option>
            <option value="JSON">JSON</option>
            <option value="XML">XML</option>
          </select>
        </div>

        <div class="switch-group">
          <label class="switch">
            <input type="checkbox" id="dateSwitch" checked>
            <span class="slider"></span>
          </label>
          <span class="switch-label">日期</span>
        </div>

        <div class="form-row" id="dateFields">
          <div class="form-group">
            <label class="form-label">有效期月份</label>
            <select class="form-select" id="expiryMonth">
              <option value="Random">随机</option>
              <option value="01">01</option>
              <option value="02">02</option>
              <option value="03">03</option>
              <option value="04">04</option>
              <option value="05">05</option>
              <option value="06">06</option>
              <option value="07">07</option>
              <option value="08">08</option>
              <option value="09">09</option>
              <option value="10">10</option>
              <option value="11">11</option>
              <option value="12">12</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">有效期年份</label>
            <select class="form-select" id="expiryYear">
              <option value="Random">随机</option>
              <option value="2025">2025</option>
              <option value="2026">2026</option>
              <option value="2027">2027</option>
              <option value="2028">2028</option>
              <option value="2029">2029</option>
              <option value="2030">2030</option>
            </select>
          </div>
        </div>

        <div class="switch-group">
          <label class="switch">
            <input type="checkbox" id="cvvSwitch" checked>
            <span class="slider"></span>
          </label>
          <span class="switch-label">安全码</span>
        </div>

        <div class="form-group" id="cvvField">
          <label class="form-label">CVV 安全码</label>
          <input type="text" class="form-input" id="cvvInput" placeholder="留空则随机生成">
        </div>

        <div class="form-group">
          <label class="form-label">生成数量</label>
          <select class="form-select" id="quantity">
            <option value="10" selected>10</option>
            <option value="20">20</option>
            <option value="50">50</option>
            <option value="100">100</option>
            <option value="200">200</option>
            <option value="500">500</option>
          </select>
        </div>

        <button class="btn-generate" onclick="generate()">
          <span>⚙️</span> 生成
        </button>
      </div>

      <!-- 右侧结果面板 -->
      <div class="result-panel">
        <div class="tabs">
          <button class="tab active" onclick="switchTab('basic')">基础</button>
          <button class="tab" onclick="switchTab('advance')">高级</button>
        </div>

        <div class="tab-content">
          <div class="result-header">
            <div class="result-stats hidden" id="stats">
              <div class="stat-item">
                <span>📊</span>
                <span class="stat-value" id="statCount">0</span>
                <span>个</span>
              </div>
              <div class="stat-item">
                <span>💳</span>
                <span class="stat-value" id="statBrand">-</span>
              </div>
            </div>
          </div>

          <div class="result-output" id="output"></div>

          <div class="result-actions">
            <button class="btn btn-primary" onclick="copyAll()">📋 复制</button>
            <button class="btn" onclick="downloadTxt()">💾 下载</button>
            <button class="btn" onclick="resetAll()">🔄 重置</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ============= Luhn 算法 =============
    
    function calculateLuhn(num) {
      let sum = 0;
      let isDouble = true;
      for (let i = num.length - 1; i >= 0; i--) {
        let digit = parseInt(num[i]);
        if (isDouble) {
          digit *= 2;
          if (digit > 9) digit -= 9;
        }
        sum += digit;
        isDouble = !isDouble;
      }
      return ((10 - (sum % 10)) % 10).toString();
    }

    function isValidLuhn(num) {
      let sum = 0;
      let isDouble = false;
      for (let i = num.length - 1; i >= 0; i--) {
        let digit = parseInt(num[i]);
        if (isDouble) {
          digit *= 2;
          if (digit > 9) digit -= 9;
        }
        sum += digit;
        isDouble = !isDouble;
      }
      return sum % 10 === 0;
    }

    // ============= 卡品牌识别 =============
    
    function detectBrand(bin) {
      const b = bin.toString();
      if (b.startsWith('4')) return { name: 'VISA', len: 16, cvv: 3 };
      if (/^5[1-5]/.test(b)) return { name: 'MasterCard', len: 16, cvv: 3 };
      if (b.startsWith('2')) {
        const n = parseInt(b.slice(0, 4));
        if (n >= 2221 && n <= 2720) return { name: 'MasterCard', len: 16, cvv: 3 };
      }
      if (b.startsWith('34') || b.startsWith('37')) return { name: 'Amex', len: 15, cvv: 4 };
      if (b.startsWith('6011') || /^64[4-9]/.test(b) || b.startsWith('65')) return { name: 'Discover', len: 16, cvv: 3 };
      if (/^35[2-8]/.test(b)) return { name: 'JCB', len: 16, cvv: 3 };
      if (b.startsWith('36') || b.startsWith('38') || b.startsWith('30')) return { name: 'Diners', len: 14, cvv: 3 };
      return { name: 'Unknown', len: 16, cvv: 3 };
    }

    // ============= 生成卡号 =============
    
    function generateCard(bin, customCvv, customMonth, customYear) {
      const cleanBin = bin.replace(/x/gi, '').replace(/\D/g, '');
      if (cleanBin.length < 4) {
        throw new Error('BIN 长度至少需要 4 位数字');
      }

      const brand = detectBrand(cleanBin);
      const needed = brand.len - cleanBin.length - 1;
      
      if (needed < 1) {
        throw new Error('BIN 长度过长，无法生成有效卡号');
      }

      let num = cleanBin;
      for (let i = 0; i < needed; i++) {
        num += Math.floor(Math.random() * 10);
      }
      
      num += calculateLuhn(num);

      if (!isValidLuhn(num)) {
        throw new Error('Luhn 校验失败');
      }

      // 生成有效期
      let month, year;
      if (customMonth === 'Random') {
        month = String(Math.floor(Math.random() * 12) + 1).padStart(2, '0');
      } else {
        month = customMonth;
      }

      if (customYear === 'Random') {
        const now = new Date();
        const currentYear = now.getFullYear();
        year = String(currentYear + Math.floor(Math.random() * 3) + 3);
      } else {
        year = customYear;
      }

      // 生成 CVV
      let cvv;
      if (customCvv) {
        cvv = customCvv;
      } else {
        if (brand.cvv === 4) {
          cvv = String(Math.floor(Math.random() * 9000) + 1000);
        } else {
          cvv = String(Math.floor(Math.random() * 900) + 100);
        }
      }

      return {
        number: num,
        month: month,
        year: year,
        cvv: cvv,
        brand: brand.name
      };
    }

    // ============= UI 交互 =============
    
    let generatedCards = [];

    function switchTab(tab) {
      // 更新标签状态
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
    }

    function formatOutput(cards, format) {
      if (format === 'PIPE') {
        return cards.map(c => `${c.number}|${c.month}|${c.year}|${c.cvv}`).join('\n');
      } else if (format === 'CSV') {
        let result = 'Card Number,Month,Year,CVV\n';
        result += cards.map(c => `${c.number},${c.month},${c.year},${c.cvv}`).join('\n');
        return result;
      } else if (format === 'JSON') {
        return JSON.stringify(cards, null, 2);
      } else if (format === 'XML') {
        let result = '<?xml version="1.0" encoding="UTF-8"?>\n<cards>\n';
        cards.forEach(c => {
          result += `  <card>\n`;
          result += `    <number>${c.number}</number>\n`;
          result += `    <month>${c.month}</month>\n`;
          result += `    <year>${c.year}</year>\n`;
          result += `    <cvv>${c.cvv}</cvv>\n`;
          result += `  </card>\n`;
        });
        result += '</cards>';
        return result;
      }
      return '';
    }

    function generate() {
      try {
        const customBin = document.getElementById('binInput').value.trim();
        const selectedBin = document.getElementById('binSelect').value;
        const bin = customBin || selectedBin;
        
        const format = document.getElementById('formatSelect').value;
        const quantity = parseInt(document.getElementById('quantity').value);
        const includeDate = document.getElementById('dateSwitch').checked;
        const includeCvv = document.getElementById('cvvSwitch').checked;
        const customCvv = document.getElementById('cvvInput').value.trim();
        const customMonth = document.getElementById('expiryMonth').value;
        const customYear = document.getElementById('expiryYear').value;

        if (!bin) {
          throw new Error('请选择或输入 BIN');
        }

        const cards = [];
        for (let i = 0; i < quantity; i++) {
          try {
            const card = generateCard(bin, customCvv, customMonth, customYear);
            cards.push(card);
          } catch (e) {
            // 跳过失败的
          }
        }

        if (cards.length === 0) {
          throw new Error('生成失败，请检查 BIN 设置');
        }

        generatedCards = cards;

        // 格式化输出
        const output = formatOutput(cards, format);
        document.getElementById('output').textContent = output;

        // 显示统计
        const stats = document.getElementById('stats');
        stats.classList.remove('hidden');
        document.getElementById('statCount').textContent = cards.length;
        document.getElementById('statBrand').textContent = cards[0].brand;

        toast(`✓ 成功生成 ${cards.length} 个卡号`, 'success');
      } catch (e) {
        toast(e.message, 'error');
      }
    }

    function copyAll() {
      const text = document.getElementById('output').textContent;
      if (!text) {
        toast('✗ 没有可复制的内容', 'error');
        return;
      }
      copy(text);
      toast('✓ 已复制到剪贴板', 'success');
    }

    function downloadTxt() {
      const text = document.getElementById('output').textContent;
      if (!text) {
        toast('✗ 没有可下载的内容', 'error');
        return;
      }
      const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `test-cards-${Date.now()}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      toast('✓ 文件已下载', 'success');
    }

    function resetAll() {
      generatedCards = [];
      document.getElementById('output').textContent = '';
      document.getElementById('stats').classList.add('hidden');
      toast('✓ 已重置', 'success');
    }

    function copy(text) {
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.opacity = '0';
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand('copy');
      document.body.removeChild(textarea);
    }

    function toast(msg, type = 'success') {
      const existing = document.querySelector('.toast');
      if (existing) existing.remove();

      const div = document.createElement('div');
      div.className = `toast ${type}`;
      div.innerHTML = `<span>${msg}</span>`;
      document.body.appendChild(div);

      setTimeout(() => div.remove(), 2500);
    }

    // 从下拉选择更新BIN输入框
    function updateBinFromSelect() {
      const selected = document.getElementById('binSelect').value;
      if (selected) {
        document.getElementById('binInput').value = '';
      }
    }

    // 开关控制
    document.getElementById('dateSwitch').addEventListener('change', (e) => {
      document.getElementById('dateFields').style.display = e.target.checked ? 'grid' : 'none';
    });

    document.getElementById('cvvSwitch').addEventListener('change', (e) => {
      document.getElementById('cvvField').style.display = e.target.checked ? 'block' : 'none';
    });

    // 回车生成
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && e.target.id === 'binInput') {
        generate();
      }
    });
  </script>
</body>
</html>
